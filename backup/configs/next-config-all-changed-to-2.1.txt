IR1101_FCW2452P6PY#show running
Building configuration...

Current configuration : 21858 bytes
!
! Last configuration change at 16:56:46 gmt Sat Apr 16 2022 by cisco
!
version 17.8
service tcp-keepalives-in
service tcp-keepalives-out
service timestamps debug datetime msec
service timestamps log datetime msec
service password-encryption
service call-home
platform qfp utilization monitor load 80
no platform punt-keepalive disable-kernel-core
!
hostname IR1101_FCW2452P6PY
!
boot-start-marker
boot system flash ir1101-universalk9.17.08.01prd5.SPA.bin
boot-end-marker
!
!
vrf definition ciscoiot
 !
 address-family ipv4
 exit-address-family
!
aaa new-model
!
!
aaa authentication login default local
aaa authorization console
aaa authorization exec default local
aaa authorization network default local
!
!
!
!
!
!
aaa session-id common
clock timezone gmt 0 0
!
!
!
!
ip nbar http-services
!
!
!
!
!
ip name-server 192.168.1.1 8.8.8.8
ip domain name local
ip dhcp excluded-address 192.168.2.0
!
ip dhcp pool webuidhcp
 network 192.168.3.0 255.255.255.0
 lease infinite
!
ip dhcp pool ioxpool
 network 10.8.87.112 255.255.255.248
 default-router 10.8.87.113
 dns-server 8.8.8.8
 lease infinite
 remember
!
ip dhcp pool subtended
 network 192.168.2.0 255.255.255.0
 default-router 192.168.2.1
 dns-server 8.8.8.8
 lease 0 0 10
!
!
!
login block-for 60 attempts 3 within 30
login delay 3
login on-success log
!
!
!
!
!
!
!
subscriber templating
!
!
!
!
!
multilink bundle-name authenticated
!
!
!
!
!
!
!
!
!
crypto pki trustpoint TP-self-signed-3791003739
 enrollment selfsigned
 subject-name cn=IOS-Self-Signed-Certificate-3791003739
 revocation-check none
 rsakeypair TP-self-signed-3791003739
!
crypto pki trustpoint SLA-TrustPoint
 enrollment pkcs12
 revocation-check crl
!
crypto pki trustpoint primary-cert
 revocation-check none
!
!
crypto pki certificate chain TP-self-signed-3791003739
 certificate self-signed 01
  30820330 30820218 A0030201 02020101 300D0609 2A864886 F70D0101 05050030
  31312F30 2D060355 04031326 494F532D 53656C66 2D536967 6E65642D 43657274
  69666963 6174652D 33373931 30303337 3339301E 170D3231 31323239 31333537
  32355A17 0D333131 32323931 33353732 355A3031 312F302D 06035504 03132649
  4F532D53 656C662D 5369676E 65642D43 65727469 66696361 74652D33 37393130
  30333733 39308201 22300D06 092A8648 86F70D01 01010500 0382010F 00308201
  0A028201 0100A2A0 98CE372A 7881A813 64D41AEA 7E4BB775 B32AFA8B E3933A76
  9F407347 30C6E0FB 4085899D 2A892CA5 A574C84D FF2FF13D E717CFFE 2F2A64E2
  43DC61C5 963084E6 66A33932 2549474F 76A2DB5E 53BC9E74 DA573BFB 575B9C73
  76663D9F 2E9C2B3C E25891C0 C409664C 8A0D0ADC BC461D98 09C0318C 0D648F53
  1788C41F 1DB70797 30785B9B 7B6C5BB8 12904B49 DA0C6AD4 38F02481 4CFB078C
  C8A0E8B0 C52608A5 AD45E70A 27A6FEE7 6FFB01A3 88023C10 9E0C3AB9 3016A8CA
  8F9E7FBC 893811E0 4F24F79A 80864672 EB749475 3B585BE1 DC7B2BD0 09A18D9A
  9D8B1588 D59EFB34 0B0DBC27 6EFA0133 C3B24BA2 3371D187 54774537 9CFD8FEA
  2468E604 C6390203 010001A3 53305130 0F060355 1D130101 FF040530 030101FF
  301F0603 551D2304 18301680 146B7B6E 339B5902 0F05D688 EEA1927D 31602CAA
  9E301D06 03551D0E 04160414 6B7B6E33 9B59020F 05D688EE A1927D31 602CAA9E
  300D0609 2A864886 F70D0101 05050003 82010100 0CA50A0F 42643BB0 9D473BAB
  00C24A92 A42BB518 1A774518 DE5E8F82 792374F9 D62B4A73 D1832B89 FEAC6D1D
  2C067F9D B5509FC0 22C78234 F1313927 AE2FCD01 89D0CCC5 41ABB12F 734AA962
  B3C7C443 C6AC8B5E 5258FA1F 11ED38BF 6A594F24 15991AB3 30D77E3A BE7A57E9
  64278260 A995296C A21C2B15 E820A2B8 EC6C9FE0 F7C2D4C2 1A0798F0 A5E135A1
  8FD36D5F E061BB8F 8FBCEA43 3DBA9694 3FB676DD 8B9452E1 DD9DAB24 DFE1C817
  B6E2A214 F9FDFD03 5E3B4D2F 733AFA84 31CF1B2A 1AADCF00 35D59BE9 28E06E84
  EE106D8F 01FADF50 C1F55646 54E358AA F31AC28E 3A020DF6 5D439945 2D8DBFA2
  7D23C2C2 1C12692F 073B53BF BF9FA254 C6AD41F8
        quit
crypto pki certificate chain SLA-TrustPoint
 certificate ca 01
  30820321 30820209 A0030201 02020101 300D0609 2A864886 F70D0101 0B050030
  32310E30 0C060355 040A1305 43697363 6F312030 1E060355 04031317 43697363
  6F204C69 63656E73 696E6720 526F6F74 20434130 1E170D31 33303533 30313934
  3834375A 170D3338 30353330 31393438 34375A30 32310E30 0C060355 040A1305
  43697363 6F312030 1E060355 04031317 43697363 6F204C69 63656E73 696E6720
  526F6F74 20434130 82012230 0D06092A 864886F7 0D010101 05000382 010F0030
  82010A02 82010100 A6BCBD96 131E05F7 145EA72C 2CD686E6 17222EA1 F1EFF64D
  CBB4C798 212AA147 C655D8D7 9471380D 8711441E 1AAF071A 9CAE6388 8A38E520
  1C394D78 462EF239 C659F715 B98C0A59 5BBB5CBD 0CFEBEA3 700A8BF7 D8F256EE
  4AA4E80D DB6FD1C9 60B1FD18 FFC69C96 6FA68957 A2617DE7 104FDC5F EA2956AC
  7390A3EB 2B5436AD C847A2C5 DAB553EB 69A9A535 58E9F3E3 C0BD23CF 58BD7188
  68E69491 20F320E7 948E71D7 AE3BCC84 F10684C7 4BC8E00F 539BA42B 42C68BB7
  C7479096 B4CB2D62 EA2F505D C7B062A4 6811D95B E8250FC4 5D5D5FB8 8F27D191
  C55F0D76 61F9A4CD 3D992327 A8BB03BD 4E6D7069 7CBADF8B DF5F4368 95135E44
  DFC7C6CF 04DD7FD1 02030100 01A34230 40300E06 03551D0F 0101FF04 04030201
  06300F06 03551D13 0101FF04 05300301 01FF301D 0603551D 0E041604 1449DC85
  4B3D31E5 1B3E6A17 606AF333 3D3B4C73 E8300D06 092A8648 86F70D01 010B0500
  03820101 00507F24 D3932A66 86025D9F E838AE5C 6D4DF6B0 49631C78 240DA905
  604EDCDE FF4FED2B 77FC460E CD636FDB DD44681E 3A5673AB 9093D3B1 6C9E3D8B
  D98987BF E40CBD9E 1AECA0C2 2189BB5C 8FA85686 CD98B646 5575B146 8DFC66A8
  467A3DF4 4D565700 6ADF0F0D CF835015 3C04FF7C 21E878AC 11BA9CD2 55A9232C
  7CA7B7E6 C1AF74F6 152E99B7 B1FCF9BB E973DE7F 5BDDEB86 C71E3B49 1765308B
  5FB0DA06 B92AFE7F 494E8A9E 07B85737 F3A58BE1 1A48A229 C37C1E69 39F08678
  80DDCD16 D6BACECA EEBC7CF9 8428787B 35202CDC 60E4616A B623CDBD 230E3AFB
  418616A9 4093E049 4D10AB75 27E86F73 932E35B5 8862FDAE 0275156F 719BB2F0
  D697DF7F 28
        quit
crypto pki certificate chain primary-cert
 certificate ca 7D5B5126B476BA11DB74160BBC530DA7
  30820613 308203FB A0030201 0202107D 5B5126B4 76BA11DB 74160BBC 530DA730
  0D06092A 864886F7 0D01010C 05003081 88310B30 09060355 04061302 55533113
  30110603 55040813 0A4E6577 204A6572 73657931 14301206 03550407 130B4A65
  72736579 20436974 79311E30 1C060355 040A1315 54686520 55534552 54525553
  54204E65 74776F72 6B312E30 2C060355 04031325 55534552 54727573 74205253
  41204365 72746966 69636174 696F6E20 41757468 6F726974 79301E17 0D313831
  31303230 30303030 305A170D 33303132 33313233 35393539 5A30818F 310B3009
  06035504 06130247 42311B30 19060355 04081312 47726561 74657220 4D616E63
  68657374 65723110 300E0603 55040713 0753616C 666F7264 31183016 06035504
  0A130F53 65637469 676F204C 696D6974 65643137 30350603 55040313 2E536563
  7469676F 20525341 20446F6D 61696E20 56616C69 64617469 6F6E2053 65637572
  65205365 72766572 20434130 82012230 0D06092A 864886F7 0D010101 05000382
  010F0030 82010A02 82010100 D67333D6 D73C20D0 00D21745 B8D63E07 A23FC741
  EE3230C9 B06CFDF4 9FCB1298 0F2D3F8D 4D010C82 0F177F62 2EE9B848 79FB1683
  4EADD732 2593B707 BFB9503F A94CC340 2AE939FF D981CA1F 163241DA 8026B923
  7A87201E E3FF209A 3C95446F 87750690 40B43293 16091008 233ED2DD 870F6F5D
  51146A0A 69C54F01 7269CFD3 934C6D04 A0A31B82 7EB19AB9 EDC59EC5 37789F9A
  0834FB56 2E58C409 0E06645B BC37DCF1 9F2868A8 56B092A3 5C9FBB88 98081B24
  1DAB3085 AEAFB02E 9E7A9DC1 C0421CE2 02F0EAE0 4AD2EF90 0EB4C140 16F06F85
  424A64F7 A430A0FE BF2EA327 5A8E8B58 B8ADC319 178463ED 6F56FD83 CB6034C4
  74BEE69D DBE1E4E5 CA0C5F15 02030100 01A38201 6E308201 6A301F06 03551D23
  04183016 80145379 BF5AAA2B 4ACF5480 E1D89BC0 9DF2B203 66CB301D 0603551D
  0E041604 148D8C5E C454AD8A E177E99B F99B05E1 B8018D61 E1300E06 03551D0F
  0101FF04 04030201 86301206 03551D13 0101FF04 08300601 01FF0201 00301D06
  03551D25 04163014 06082B06 01050507 03010608 2B060105 05070302 301B0603
  551D2004 14301230 06060455 1D200030 08060667 810C0102 01305006 03551D1F
  04493047 3045A043 A041863F 68747470 3A2F2F63 726C2E75 73657274 72757374
  2E636F6D 2F555345 52547275 73745253 41436572 74696669 63617469 6F6E4175
  74686F72 6974792E 63726C30 7606082B 06010505 07010104 6A306830 3F06082B
  06010505 07300286 33687474 703A2F2F 6372742E 75736572 74727573 742E636F
  6D2F5553 45525472 75737452 53414164 64547275 73744341 2E637274 30250608
  2B060105 05073001 86196874 74703A2F 2F6F6373 702E7573 65727472 7573742E
  636F6D30 0D06092A 864886F7 0D01010C 05000382 02010032 BF61BD0E 48C34FC7
  BA474DF8 9C781901 DC131D80 6FFCC370 B4529A31 339A5752 FB319E6B A4EF54AA
  898D4017 68F81110 7CD2CAB1 F15586C7 EEB33691 86F63951 BF46BF0F A0BAB4F7
  7E49C42A 36179EE4 68397AAF 944E566F B27B3BBF 0A86BDCD C5771C03 B838B1A2
  1F5F7EDB 8ADC4648 B6680ACF B2B5B4E2 34E467A9 3866095E D2B8FC9D 283A1740
  27C2724E 29FD213C 7CCF13FB 962CC531 44FD13ED D59BA969 68777CEE E1FFA4F9
  36380853 39A28434 9C19F3BE 0EACD524 37EB23A8 78D0D3E7 EF924764 623922EF
  C6F711BE 2285C666 4424268E 10328DC8 93AE079E 833E2FD9 F9F5468E 63BEC1E6
  B4DCA6CD 21A8860A 95D92E85 261AFDFC B1B65742 6D95D133 F6391406 824138F5
  8F58DC80 5BA4D57D 9578FDA7 9BFFFDC5 A869AB26 E7A7A405 875BA9B7 B8A3200B
  97A94585 DDB38BE5 89378E29 0DFC0617 F638400E 42E41206 FB7BF3C6 116862DF
  E398F413 D8154F8B B169D910 60BC642A EA31B7E4 B5A33A14 9B26E30B 7BFD028E
  B699C138 975936F6 A874A286 B65EEBC6 64EACFA0 A3F96E9E BA2D11B6 86980858
  2DC9AC25 64F25E75 B438C1AE 7F5A4683 EA51CAB6 F1991135 6BA56A7B C600B0E7
  F8BE64B2 ADC8C2F1 ACE351EA A493E079 C8E18140 C90A5BE1 123CC160 2AE397C0
  8942CA94 CF469812 69BB98D0 C2D30D72 4B476EE5 93C43228 638743E4 B0323E0A
  D34BBF23 9B142941 2B9A041F 932DF1C7 39483CAD 5A127F
        quit
!
!
!
!
!
!
!
!
!
no license feature hseck9
license udi pid IR1101-K9 sn FCW2452P6PY
archive
 path bootflash:/
 maximum 3
memory free low-watermark processor 48732
!
diagnostic bootup level minimal
!
spanning-tree extend system-id
!
!
!
username admin privilege 15 secret 9 $9$EaEl5Du9wqqh8E$LjOIBsI6vgVfzj8RWsjH66U2ldYFMSU/eCv5afk1GZE
username cisco privilege 15 secret 9 $9$63jbYyq9kb8jh.$1o/Fpb2wliZi/dQ8nGnO64f97Sw5n0PjMPv7nFyeUb6
!
redundancy
crypto ikev2 authorization policy default
 route set interface
 route set access-list GWIPS
!
!
!
crypto ikev2 keyring Flex_key
 peer cloud-core-router
  address 54.72.71.96
  identity key-id cloud-core-router
  pre-shared-key cisco1234test
 !
!
!
crypto ikev2 profile Flex_IKEv2
 match identity remote key-id cloud-core-router
 identity local email FCW2452P6PY@ciscoiotdev.io
 authentication remote pre-share
 authentication local pre-share
 keyring local Flex_key
 dpd 29 2 periodic
 nat force-encap
 aaa authorization group psk list default default
!
crypto ikev2 client flexvpn Tunnel1
  peer 1 54.72.71.96
  source 1 GigabitEthernet0/0/0 track 1
  source 2 Cellular0/1/0 track 2
  client connect Tunnel1
!
!
controller Cellular 0/1/0
 lte gps mode standalone
 lte gps nmea
 src-ip-violation-action drop ipv4
!
!
vlan internal allocation policy ascending
!
track 1 interface GigabitEthernet0/0/0 ip routing
!
track 2 interface Cellular0/1/0 ip routing
!
track 40 ip sla 40 reachability
!
track 111 interface Tunnel1 ip routing
!
!
class-map type inspect match-any eCVD-deny-list
 match access-group name eCVD-deny-from-outside
class-map type inspect match-any Everything
 match access-group name Everything
class-map type inspect match-any eCVD-permit-list
 match access-group name eCVD-permit-from-outside
class-map type inspect match-any bypass-cm
 match access-group name filter-dhcp
 match access-group name filter-traceroute
class-map type inspect match-any allowed-internet
 match access-group name filter-internet
 match protocol icmp
!
policy-map type inspect Any2SELF
 class type inspect bypass-cm
  pass
 class type inspect Everything
  inspect
 class class-default
policy-map type inspect INTERNET2Any
 class type inspect bypass-cm
  pass
 class type inspect allowed-internet
  inspect
 class type inspect eCVD-permit-list
  inspect
 class type inspect eCVD-deny-list
  drop
 class class-default
policy-map type inspect StdPolicy
 class type inspect bypass-cm
  pass
 class type inspect Everything
  inspect
 class class-default
!
zone security INTERNET
zone security default
zone-pair security INTERNET-TO-SELF source INTERNET destination self
 service-policy type inspect INTERNET2Any
zone-pair security INTERNET-TO-default source INTERNET destination default
 service-policy type inspect INTERNET2Any
zone-pair security SELF-TO-INTERNET source self destination INTERNET
 service-policy type inspect StdPolicy
zone-pair security SELF-TO-default source self destination default
 service-policy type inspect StdPolicy
zone-pair security default-TO-INTERNET source default destination INTERNET
 service-policy type inspect StdPolicy
zone-pair security default-TO-SELF source default destination self
 service-policy type inspect Any2SELF
!
!
!
!
!
!
!
!
!
!
crypto ipsec profile default
 set ikev2-profile Flex_IKEv2
!
!
!
!
!
!
!
!
!
interface Loopback1
 vrf forwarding ciscoiot
 ip address 10.8.87.97 255.255.255.255
 ip nat inside
 ip policy route-map VRF_TO_GLOBAL
!
interface Tunnel1
 vrf forwarding ciscoiot
 ip address negotiated
 ip mtu 1340
 ip tcp adjust-mss 1300
 tunnel source dynamic
 tunnel mode ipsec ipv4
 tunnel destination dynamic
 tunnel path-mtu-discovery
 tunnel protection ipsec profile default
!
interface VirtualPortGroup0
 description IOx Interface
 ip address 10.8.87.113 255.255.255.248
 ip nat inside
 ipv6 enable
!
interface GigabitEthernet0/0/0
 ip dhcp client client-id ascii cisco-a03d.6e75.f500-Gi0/0/0
 ip address dhcp
 ip nat outside
 media-type rj45
!
interface FastEthernet0/0/1
 description SUBTENDED NETWORK
!
interface FastEthernet0/0/2
 description SUBTENDED NETWORK
!
interface FastEthernet0/0/3
 description SUBTENDED NETWORK
!
interface FastEthernet0/0/4
 description SUBTENDED NETWORK
!
interface Cellular0/1/0
 ip address negotiated
 zone-member security INTERNET
 dialer in-band
 dialer-group 1
 ipv6 enable
 pulse-time 1
!
interface Cellular0/1/1
 no ip address
 shutdown
!
interface Vlan1
 ip address 192.168.2.1 255.255.255.0
 ip nbar protocol-discovery
 ip nat inside
 ip verify unicast source reachable-via rx
!
interface Async0/2/0
 no ip address
 encapsulation relay-line
!
iox
ip forward-protocol nd
no ip http server
ip http auth-retry 3 time-window 1
ip http authentication local
ip http secure-server
ip http client source-interface Loopback1
ip http client secure-trustpoint CISCO_IDEVID_SUDI
ip dns server
ip nat inside source route-map RM_WAN_ACL2 interface GigabitEthernet0/0/0 overload
ip nat inside source route-map track-primary-if interface GigabitEthernet0/0/0 overload
ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/0/0
ip route 4.2.2.1 255.255.255.255 Null0 3
ip route 54.72.71.96 255.255.255.255 Cellular0/1/0 10
ip route 54.72.71.96 255.255.255.255 GigabitEthernet0/0/0 dhcp
ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/0/0 dhcp 100
ip route 4.2.2.1 255.255.255.255 dhcp
ip ssh rsa keypair-name SSHKEY
ip ssh version 2
ip scp server enable
!
!
ip access-list standard CLOUD
 10 permit 192.168.2.0 0.0.0.255
ip access-list standard GWIPS
 10 permit 10.8.87.96 0.0.0.31
ip access-list standard IOxRange
 10 permit 10.8.87.112 0.0.0.7
!
ip access-list extended Everything
 10 permit ip any any
ip access-list extended NAT_ACL
 10 permit ip 10.8.87.112 0.0.0.7 any
 20 permit ip 192.168.2.0 0.0.0.255 any
 30 permit ip 192.168.2.0 0.0.0.31 any
ip access-list extended eCVD-deny-from-outside
ip access-list extended eCVD-permit-from-outside
ip access-list extended filter-dhcp
 10 permit udp any eq bootpc host 255.255.255.255 eq bootps
 20 permit udp any eq bootps host 255.255.255.255 eq bootpc
ip access-list extended filter-internet
 10 permit icmp any any echo
 20 permit icmp any any echo-reply
 30 permit icmp any any unreachable
 40 permit icmp any any packet-too-big
 50 permit icmp any any ttl-exceeded
 60 permit udp any eq bootps host 255.255.255.255 eq bootpc
ip access-list extended filter-traceroute
 10 permit icmp any any host-unreachable
 20 permit icmp any any time-exceeded
 30 permit icmp any any unreachable
 40 permit icmp any any ttl-exceeded
!
ip sla 40
 icmp-echo 4.2.2.1 source-interface GigabitEthernet0/0/0
  frequency 10
ip sla schedule 40 life forever start-time now
dialer watch-list 1 ip 5.6.7.8 0.0.0.0
dialer watch-list 1 delay route-check initial 1
dialer watch-list 1 delay connect 1
dialer-list 1 protocol ip permit
!
route-map track-primary-if permit 1
 match ip address 197
 set interface GigabitEthernet0/0/0
!
route-map RM_WAN_ACL2 permit 10
 match ip address NAT_ACL
 match interface GigabitEthernet0/0/0
!
snmp-server group cgnms v3 priv
snmp-server trap-source Loopback1
snmp-server enable traps snmp linkdown linkup coldstart warmstart
snmp-server enable traps cisco-sys heartbeat
snmp-server enable traps fru-ctrl
snmp-server enable traps aaa_server
snmp-server enable traps c3g
!
!
!
!
control-plane
!
!
!
mgcp behavior rsip-range tgcp-only
mgcp behavior comedia-role none
mgcp behavior comedia-check-media-src disable
mgcp behavior comedia-sdp-force disable
!
mgcp profile default
!
!
!
!
!
banner login ^CCisco IoT Gateway v2.8^C
alias exec cfgdiff show archive config differences nvram:startup-config system:running-config
!
line con 0
 exec-timeout 0 0
 length 0
 stopbits 1
line 0/0/0
line 0/2/0
line vty 0 4
 exec-timeout 5 0
 length 0
 transport input ssh
line vty 5 99
 transport input none
!
call-home
 ! If contact email address in call-home is configured as sch-smart-licensing@cisco.com
 ! the email address configured in Cisco Smart License Portal will be used as contact email address to send SCH notifications.
 contact-email-addr sch-smart-licensing@cisco.com
 profile "CiscoTAC-1"
  active
  destination transport-method http
ntp server time.nist.gov
!
wsma agent exec
 profile exec
!
wsma agent config
 profile config
!
!
!
!
wsma profile listener exec
 transport https path /wsma/exec
!
wsma profile listener config
 transport https path /wsma/config
!
cgna gzip
!
cgna heart-beat interval 5
cgna heart-beat active
!
cgna profile cg-nms-register
 add-command show version | format flash:/managed/odm/cg-nms.odm
 add-command show inventory | format flash:/managed/odm/cg-nms.odm
 interval 3
 url https://eu-int.ciscoiot.com/cgna/ios/registration
 gzip
!
cgna profile cg-nms-periodic
 add-command show version | format flash:/managed/odm/cg-nms.odm
 add-command show hosts | format flash:/managed/odm/cg-nms.odm
 add-command show interfaces | format flash:/managed/odm/cg-nms.odm
 add-command show ipv6 dhcp | format flash:/managed/odm/cg-nms.odm
 add-command show ipv6 interface | format flash:/managed/odm/cg-nms.odm
 add-command show snmp mib ifmib ifindex | format flash:/managed/odm/cg-nms.odm
 add-command show inventory | format flash:/managed/odm/cg-nms.odm
 add-command show iox-service | format flash:/managed/odm/cg-nms.odm
 add-command show cellular 0/1/0 all | format flash:/managed/odm/cg-nms.odm
 interval 30
 url https://eu-int.ciscoiot.com/cgna/ios/metrics
 gzip
 active
!
!
!
!
event manager environment herip 54.72.71.96
event manager directory user policy "flash:/managed/scripts"
event manager applet updateSNMP
 event timer watchdog time 600
 action 10 cli command "enable"
 action 20 cli command "show run | i ^snmp-server host"
 action 30 set snmphosts "$_cli_result"
 action 40 cli command "conf t"
 action 41 foreach line "$snmphosts" "\n"
 action 42  string match "snmp-server*" "$line"
 action 43  if $_string_result ne "1"
 action 44   continue
 action 45  end
 action 46  cli command "no $line"
 action 49 end
 action 50 cli command "snmp-server host eu1-udp-nlb-internal.ciscoiot.com vrf ciscoiot version 3 priv admin"
 action 51 string match "*Invalid*" "$_cli_result"
 action 52 if $_string_result eq "1"
 action 53  foreach line "$snmphosts" "\n"
 action 54   string match "*vrf*" "$line"
 action 55   if $_string_result eq "1"
 action 56    cli command "$line"
 action 57    break
 action 58   end
 action 59  end
 action 60 end
event manager applet MgmtTuRecvry
 event tag 1 track 111 state down maxrun 330
 event tag 2 counter name MgmtTuDwn entry-val 1 entry-op ge exit-val 1 exit-op ge
 event tag 3 timer cron cron-entry "@reboot"
 trigger
  correlate event 1 or event 2 or event 3
 action 10 track read 111
 action 11 if $_track_state eq "up"
 action 12  counter name "MgmtTuDwn" op set value 0
 action 13  exit
 action 14 end
 action 15 cli command "enable"
 action 16 cli command "ping 8.8.8.8 rep 1 time 0"
 action 20 cli command "conf t"
 action 21 cli command "crypto ikev2 client flexvpn Tunnel1"
 action 22 cli command "peer 1 fqdn csr0-eu1.ciscoiot.com"
 action 23 regexp "resolved to address: ([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)\r" "$_cli_result" match newip
 action 24 if $_regexp_result eq "1"
 action 30  if $newip ne "$herip"
 action 31   cli command "crypto ikev2 keyring Flex_key"
 action 32   cli command "peer cloud-core-router"
 action 33   cli command "address $newip"
 action 34   cli command "ip route $newip 255.255.255.255 GigabitEthernet0/0/0 dhcp"
 action 35   cli command "ip route $newip 255.255.255.255 Cellular 0/1/0 10"
 action 36   cli command "no ip route $herip 255.255.255.255 GigabitEthernet0/0/0 dhcp"
 action 37   cli command "no ip route $herip 255.255.255.255 Cellular 0/1/0 10"
 action 50   cli command "event man env herip $newip"
 action 51   cli command "do wr"
 action 60  end
 action 70 end
 action 90 wait 300
 action 91 counter name "MgmtTuDwn" op inc value 1
event manager applet failover_40
 event track 40 state any
 action 0.1 syslog msg "GigabitEthernet 0/0/0 connectivity change, clearing NAT translations"
 action 0.2 cli command "enable"
 action 1.0 cli command "clear ip nat translation *"
event manager applet remove-cell0-route-failproof-cli
 event timer countdown time 15
 action 600 cli command "enable"
 action 610 cli command "conf t"
 action 620 cli command "no ip route 0.0.0.0 0.0.0.0 Cellular 0/1/0 100"
event manager policy no_config_replace.tcl type system authorization bypass
!
end

IR1101_FCW2452P6PY#
